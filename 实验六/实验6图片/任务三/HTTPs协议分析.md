# HTTP over TLS

## Client Hello

启动握手过程并向服务器发送一些关键信息

1. 协商加密算法和密钥

   - Client Hello 中包含了客户端支持的加密算法列表、压缩算法列表和一些其他的参数。
   - 服务器在收到 Client Hello 后，会从这个列表中选择一个与之兼容的加密算法和参数，用于后续的通信。

2. 生成随机数

   双方的随机数与其他握手参数一起输入到KDF中，生成最终的对称密钥

3. 支持的协议版本

   * Client Hello 中包含了客户端支持的 TLS/SSL 协议版本。
   * 服务器在收到 Client Hello 后，会选择一个相应的协议版本进行后续的通信。

## Server Hello

1. 服务器选择的加密算法、压缩算法等
2. 生成随机数
3. 服务器选择的协议版本

## Certificate

- **目的：** 服务器向客户端发送数字证书，证书中包含了服务器的**公钥**以及相关信息。
- **作用：** 通过证书，客户端能够验证服务器的身份，确保连接的安全性和可信度。

## Server Key Exchange

- **目的：** 在某些情况下，服务器可能会发送Server Key Exchange消息，用于传输用于密钥协商的信息。
- 如果使用数字证书传递公钥，无需发送Server Key Exchange。如果使用对称加密算法，则需发送Server Key Exchange。



## Client Key Exchange

* 生成预主密钥

  客户端将两个随机数与其他信息结合生成一个预主密钥，然后使用服务器公钥进行加密，将加密后的预主密钥发给服务器

  

  服务器接受后使用自己的私钥进行解密，得到预主密钥，通过KDF生成主密钥。

  使用生成的主密钥，服务器通过密钥派生函数生成会话密钥。会话密钥是实际用于加密和解密通信数据的对称密钥。

## New Session Ticket

会话票据是一种用于在客户端和服务器之间存储会话状态的机制

## Change Cipher Spec

服务器向客户端发送 `Change Cipher Spec` 消息，通知客户端从现在开始使用新的加密参数。这标志着从此刻开始，通信将使用新的对称密钥进行加密和解密。